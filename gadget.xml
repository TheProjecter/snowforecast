<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
  <ModulePrefs title="__UP_myname__" 
	       height="500" 
	       author="Ignacio Rodriguez" 
	       author_email="irodriguez@pegaso.ls.fi.upm.es"
               scrolling="true">
    <Require feature="dynamic-height" /> 
  </ModulePrefs>

 <UserPref name="myname" display_name="Title" required="true" default_value="Snowforecast Info"/>

  <UserPref name="mystation" display_name="Ski Resort" default_value="snow-forecast.com/resorts/La-Pinilla/6day/" datatype="enum" >
    <EnumValue value="snow-forecast.com/resorts/La-Pinilla/6day/" display_value="La Pinilla" />
    <EnumValue value="snow-forecast.com/resorts/PuertoDeNavacerrada/6day/" display_value="Puerto Navacerrada"/>
    <EnumValue value="snow-forecast.com/resorts/Valdezcaray/6day/" display_value="Valdezcaray"/>
    <EnumValue value="snow-forecast.com/resorts/Valdesqui/6day/" display_value="Valdesqui"/>
  </UserPref> 

  <UserPref name="myheight" display_name="Resort Info Altitude" default_value="bot" datatype="enum" >
    <EnumValue value="bot" display_value="Bot" />
    <EnumValue value="mid" display_value="Mid"/>
    <EnumValue value="top" display_value="Top"/>
  </UserPref> 

  <Content type="html">
  <![CDATA[ 
  <div id="content_div"></div>
  <script type="text/javascript"> 
  function displayMenu() { 
    // XML snowforecast
    
    var prefs = new _IG_Prefs(__MODULE_ID__);
    var url = "http://pallas.ls.fi.upm.es/SnowForecastServer/forecast/"+prefs.getString("mystation")+prefs.getString("myheight")+"/snowforecast.xml";
    var response = null; 
  
    _IG_FetchXmlContent(url, function (response) {
           if (response == null || typeof(response) != "object" || 
                      response.firstChild == null) {
              _gel("content_div").innerHTML = "<br>"+url+"</br>"+"<i>Invalid data.</i>";
              return;
           }

         // Close up div
         var html = "<div>"; 
         
      
         // Get the name Day
         var days = null;
         var daysNumber = null;
         var dayColor = null;
         var dayTime = null;
         var pictureWeather = null;
         var pictureWind = null;
         var snow = null;
         var rain = null;
         var maxColor = null;
         var maxTemp = null;
         var minColor = null;
         var minTemp = null;
         var sensation = null;
         var freezing = null;

         days = response.getElementsByTagName('DAYNAME');
         daysNumber = response.getElementsByTagName('DAYNUMBER');
         dayColor = response.getElementsByTagName('DAYCOLOR');
         dayTime = response.getElementsByTagName('TIME');
         pictureWeather = response.getElementsByTagName('PICTUREWEATHER');
         pictureWind = response.getElementsByTagName('PICTUREWIND');
         snow = response.getElementsByTagName('SNOW');
         rain = response.getElementsByTagName('RAIN');
         maxColor = response.getElementsByTagName('MAXCOLOR');
         maxTemp = response.getElementsByTagName('MAXTEMP');
         minColor = response.getElementsByTagName('COLORMIN');
         minTemp = response.getElementsByTagName('TEMPMIN');
         sensation = response.getElementsByTagName('SENSATION');
         freezing = response.getElementsByTagName('FREEZING');
         
        html += "<table style=\"cellspacing:0;\">";

	html+="<tr>";
	for(var i=0; i < 9; i++){
		html+="<td bgcolor='"+ dayColor[i].childNodes[0].nodeValue +
			 "' style=\"text-align:center; width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\"><b>"+
			 days[i].childNodes[0].nodeValue+"</b>"+"<br><b>"+
			 daysNumber[i].childNodes[0].nodeValue+"</b></br>"+"</td>";
             }
	html+="</tr><tr>";
	for(var i=0; i < 9; i++){
		html+="<td style=\"text-align:center; width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\"><img src='"+pictureWeather[i].childNodes[0].nodeValue+"'></td>";
             }
	html+="</tr><tr>";
	for(var i=0; i < 9; i++){
		html+="<td style=\"text-align:center; width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\"><img src='"+pictureWind[i].childNodes[0].nodeValue+"'></td>";
	}
	html+="</tr><tr>";
	for(var i=0; i < 9; i++){
		html+="<td style=\"text-align:center; font-size:80%;font-weight:bold;width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;color:#CC0000;\">"+snow[i].childNodes[0].nodeValue+"cm</td>";
	}

	html+="</tr><tr>";
	for(var i=0; i < 9; i++){
		html+="<td style=\"text-align:center; font-size:80%;font-weight:bold;width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;color:#009900;\">"+rain[i].childNodes[0].nodeValue+"mm</td>";
	}

	html+="</tr><tr>";
	for(var i=0; i < 9; i++){
		html+="<td style=\"text-align:center; font-size:80%;font-weight:bold;width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\" bgcolor='"+maxColor[i].childNodes[0].nodeValue+"'><b>"+maxTemp[i].childNodes[0].nodeValue+"&ordm;</b></td>";
	}


	html+="</tr><tr>";
	for(var i=0; i < 9; i++){
		html+="<td style=\"text-align:center; font-size:80%;font-weight:bold;width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\" bgcolor='"+minColor[i].childNodes[0].nodeValue+"'><b>"+minTemp[i].childNodes[0].nodeValue+"&ordm;</b></td>";
	}

	html+="</tr><tr>";
	for(var i=0; i < 9; i++){
		html+="<td style=\"text-align:center; font-size:80%;font-weight:bold;width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\"><b>"+sensation[i].childNodes[0].nodeValue+"&ordm;</b></td>";
	}


	html+="</tr><tr>";
	for(var i=0; i < 9; i++){
		html+="<td style=\"text-align:center; font-size:80%;font-weight:bold;width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\"><b>"+freezing[i].childNodes[0].nodeValue+"m</b></td>";
	}
 
	html+="<tr>";
	for(var i=9; i < freezing.length; i++){
		html+="<td bgcolor='"+ dayColor[i].childNodes[0].nodeValue +
			 "' style=\"text-align:center; width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\"><b>"+
			 days[i].childNodes[0].nodeValue+"</b>"+"<br><b>"+
			 daysNumber[i].childNodes[0].nodeValue+"</b></br>"+"</td>";
             }
	html+="</tr><tr>";
	for(var i=9; i < freezing.length; i++){
		html+="<td style=\"text-align:center; width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\"><img src='"+pictureWeather[i].childNodes[0].nodeValue+"'></td>";
             }

	html+="</tr><tr>";
	for(var i=9; i < freezing.length; i++){
		html+="<td style=\"text-align:center; width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\"><img src='"+pictureWind[i].childNodes[0].nodeValue+"'></td>";
	}
	html+="</tr><tr>";
	for(var i=9; i < freezing.length; i++){
		html+="<td style=\"text-align:center; font-size:90%;font-weight:bold;width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;color:#CC0000;\">"+snow[i].childNodes[0].nodeValue+"cm</td>";
	}

	html+="</tr><tr>";
	for(var i=9; i < freezing.length; i++){
		html+="<td style=\"text-align:center; font-size:80%;font-weight:bold;width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;color:#009900;\"><b>"+rain[i].childNodes[0].nodeValue+"mm</b></td>";
	}

	html+="</tr><tr>";
	for(var i=9; i < freezing.length; i++){
		html+="<td style=\"text-align:center; font-size:80%;font-weight:bold;width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\" bgcolor='"+maxColor[i].childNodes[0].nodeValue+"'><b>"+maxTemp[i].childNodes[0].nodeValue+"&ordm;</b></td>";
	}


	html+="</tr><tr>";
	for(var i=9; i < freezing.length; i++){
		html+="<td style=\"text-align:center; font-size:80%;font-weight:bold;width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\" bgcolor='"+minColor[i].childNodes[0].nodeValue+"'><b>"+minTemp[i].childNodes[0].nodeValue+"&ordm;</b></td>";
	}

	html+="</tr><tr>";
	for(var i=9; i < freezing.length; i++){
		html+="<td style=\"text-align:center; font-size:80%;font-weight:bold;width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\"><b>"+sensation[i].childNodes[0].nodeValue+"&ordm;</b></td>";
	}


	html+="</tr><tr>";
	for(var i=9; i < freezing.length; i++){
		html+="<td style=\"text-align:center; font-size:80%;font-weight:bold;width:38px; cellspacing:0; border:1px solid #666666; margin:0; padding:0;\"><b>"+freezing[i].childNodes[0].nodeValue+"m</b></td>";
	}

        html += "</tr></table></div>";

        // Display HTML string in <div>
        _gel('content_div').innerHTML = html;
    },{refreshInterval:5}); 
  }
  _IG_RegisterOnloadHandler(displayMenu);
  </script>
  ]]> 
  </Content>

</Module>
